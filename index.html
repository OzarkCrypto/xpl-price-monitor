<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPL 가격 모니터</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .card { border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .price-card { background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; }
        .price-card.hyperliquid { background: linear-gradient(45deg, #4834d4, #686de0); }
        .gap-card { background: linear-gradient(45deg, #00b894, #00cec9); color: white; }
        .btn-refresh { background: linear-gradient(45deg, #6c5ce7, #a29bfe); border: none; }
        .last-update { color: #636e72; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="text-center mb-5">
                    <h1 class="display-4 text-white mb-3">🚀 XPL 가격 모니터</h1>
                    <p class="lead text-white-50">Binance vs Hyperliquid 실시간 가격 비교</p>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card price-card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">Binance Futures</h5>
                                <div class="display-6 mb-3" id="binancePrice">-</div>
                                <a href="https://www.binance.com/en/futures/XPLUSDT" target="_blank" class="btn btn-outline-light btn-sm">거래소 방문</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card price-card hyperliquid h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">Hyperliquid</h5>
                                <div class="display-6 mb-3" id="hyperliquidPrice">-</div>
                                <a href="https://app.hyperliquid.xyz/trade" target="_blank" class="btn btn-outline-light btn-sm">거래소 방문</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card gap-card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">절대 갭</h5>
                                <div class="display-6 mb-3" id="absoluteGap">-</div>
                                <small class="text-white-50">USD 차이</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card gap-card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">상대 갭</h5>
                                <div class="display-6 mb-3" id="relativeGap">-</div>
                                <small class="text-white-50">백분율 차이</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">갭 상태</h5>
                                <div class="display-6 mb-3" id="gapStatus">-</div>
                                <div id="gapDescription" class="text-muted">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mb-4">
                    <button class="btn btn-refresh btn-lg text-white" onclick="refreshPrices()">
                        🔄 즉시 업데이트
                    </button>
                </div>
                
                <div class="text-center mt-4">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="last-update">
                                마지막 업데이트: <span id="lastUpdate">-</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="last-update">
                                <span id="secondsAgo">-</span>초 전
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let updateInterval;
        
        async function getBinancePrice() {
            try {
                const response = await fetch('https://fapi.binance.com/fapi/v1/ticker/price?symbol=XPLUSDT');
                const data = await response.json();
                return parseFloat(data.price);
            } catch (error) {
                console.error('Binance API 오류:', error);
                return null;
            }
        }
        
        async function getHyperliquidPrice() {
            try {
                const response = await fetch('https://api.hyperliquid.xyz/info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'allMids' })
                });
                const data = await response.json();
                return data.XPL ? parseFloat(data.XPL) : null;
            } catch (error) {
                console.error('Hyperliquid API 오류:', error);
                return null;
            }
        }
        
        function calculateGap(binancePrice, hyperliquidPrice) {
            if (binancePrice === null || hyperliquidPrice === null) {
                return { absolute: null, percentage: null, status: 'unknown' };
            }
            
            const absoluteGap = Math.abs(hyperliquidPrice - binancePrice);
            const percentageGap = (absoluteGap / binancePrice) * 100;
            
            let status;
            if (percentageGap < 1) status = 'low';
            else if (percentageGap < 5) status = 'medium';
            else status = 'high';
            
            return {
                absolute: absoluteGap,
                percentage: percentageGap,
                status: status
            };
        }
        
        async function updatePrices() {
            const binancePrice = await getBinancePrice();
            const hyperliquidPrice = await getHyperliquidPrice();
            
            // Binance 가격 표시
            if (binancePrice !== null) {
                document.getElementById('binancePrice').textContent = '$' + binancePrice.toFixed(6);
            } else {
                document.getElementById('binancePrice').textContent = '오류';
            }
            
            // Hyperliquid 가격 표시
            if (hyperliquidPrice !== null) {
                document.getElementById('hyperliquidPrice').textContent = '$' + hyperliquidPrice.toFixed(6);
            } else {
                document.getElementById('hyperliquidPrice').textContent = '오류';
            }
            
            // 갭 계산 및 표시
            const gap = calculateGap(binancePrice, hyperliquidPrice);
            
            if (gap.absolute !== null) {
                document.getElementById('absoluteGap').textContent = '$' + gap.absolute.toFixed(6);
                document.getElementById('relativeGap').textContent = gap.percentage.toFixed(2) + '%';
                
                const statusElement = document.getElementById('gapStatus');
                const descriptionElement = document.getElementById('gapDescription');
                
                if (gap.status === 'low') {
                    statusElement.textContent = '🟢 낮음';
                    descriptionElement.textContent = '효율적인 시장';
                } else if (gap.status === 'medium') {
                    statusElement.textContent = '🟡 보통';
                    descriptionElement.textContent = '차익거래 기회 가능';
                } else if (gap.status === 'high') {
                    statusElement.textContent = '🔴 높음';
                    descriptionElement.textContent = '시장 비효율성';
                }
            } else {
                document.getElementById('absoluteGap').textContent = '-';
                document.getElementById('relativeGap').textContent = '-';
                document.getElementById('gapStatus').textContent = '-';
                document.getElementById('gapDescription').textContent = '-';
            }
            
            // 시간 정보 업데이트
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleString('ko-KR');
            document.getElementById('secondsAgo').textContent = '0';
        }
        
        function refreshPrices() {
            updatePrices();
        }
        
        // 페이지 로드 시 가격 업데이트
        document.addEventListener('DOMContentLoaded', function() {
            updatePrices();
            updateInterval = setInterval(updatePrices, 30000);
        });
        
        // 페이지 언로드 시 인터벌 정리
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>
